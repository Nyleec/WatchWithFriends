Watch With Friends â€” Packaging & Installation for webOS (LG TV)

This document explains how to create a deployable webOS package (`.wgt`), sign it, and install it on an LG TV for testing. It also covers quick local zipping and important notes about network/CORS for S3 presigned uploads used by this project.

Prerequisites
- Node.js and npm installed (used for `ares-cli` and local development).
- Your LG TV set to Developer Mode and reachable on your local network (or use an emulator supported by the webOS SDK).
- `appinfo.json` must be present in the project root (this repo already includes it).
- A signing certificate/profile for the webOS CLI (`ares`).

Quick local package (untested placeholder)
- The repository includes a helper `package-webos.sh` that creates `dist/watchwithfriends.wgt` as a zip of the project. This is convenient for sharing files but not signed for real TV installation.

Run:
```bash
./package-webos.sh
ls -lh dist/watchwithfriends.wgt
```

Proper packaging with the webOS CLI (recommended)
1. Install `ares-cli` globally:
```bash
npm install -g ares-cli
```

2. Verify `appinfo.json` in project root. Required fields:
- `id` (e.g. `com.yourcompany.watchwithfriends`)
- `version`
- `title`
- `type: "web"`
- `main: "index.html"`

3. Create or use an existing certificate/profile for signing
- Create a developer certificate (one-time):
```bash
ares-certificate --create --name watchwithfriends-dev
```
- The command output shows where keys/profiles are stored. Keep these private.

4. Package the app into a signed `.wgt`
From the project root (where `appinfo.json` is located):
```bash
ares-package . -o watchwithfriends.wgt
```
- `ares-package` picks the default certificate profile. To specify a profile, use the `--sign` option documented in `ares-package` help.

5. Install to a TV (add device then install)
- Add your TV as a device (replace IP with your TV IP):
```bash
ares-setup-device --add --device tv1 --host 192.168.1.123
```
- Install the package to the TV:
```bash
ares-install --device tv1 watchwithfriends.wgt
```
- Launch the app:
```bash
ares-launch --device tv1 com.example.watchwithfriends
```

6. Debug and logs
- Inspect the app (remote inspector):
```bash
ares-inspect --device tv1 com.example.watchwithfriends
```
- Tail system logs from the TV:
```bash
ares-log --device tv1
```

Notes about S3 presigned uploads, CORS, and the TV
- This project supports uploading videos directly from the client to S3 using presigned PUT URLs generated by the server (`POST /presign-upload`). Browsers on the TV must be allowed by your S3 bucket CORS configuration to perform PUT requests.
- Example S3 CORS rule (allow your app origin):
```xml
<CORSConfiguration>
  <CORSRule>
    <AllowedOrigin>*</AllowedOrigin>
    <AllowedMethod>PUT</AllowedMethod>
    <AllowedMethod>GET</AllowedMethod>
    <AllowedHeader>*</AllowedHeader>
    <MaxAgeSeconds>3000</MaxAgeSeconds>
  </CORSRule>
</CORSConfiguration>
```
- In production restrict `AllowedOrigin` to your app origin or CDN domain.

Security & submission
- For distribution via the LG Content Store you must follow LG's submission process and use production signing keys as instructed by LG.
- Remove hardcoded secrets from client-side code. Server-side `.env` (e.g. `S3_BUCKET`, AWS credentials) must be kept private and never shipped in the web app package.

Troubleshooting
- If `ares-package` fails, ensure `appinfo.json` exists and `index.html` path is correct.
- If install fails on the TV: check TV developer mode, device IP, and firewall/network.
- If S3 uploads fail from the TV: check S3 CORS, and that the TV's browser supports the required Fetch/XHR features.

Want me to do this for you?
- I can update `appinfo.json` to include recommended icon fields and additional manifest metadata.
- I can prepare a sample production `ares` command with an explicit signing profile if you provide the profile name or want to create one now.

---
Generated for this repository on your machine. Follow the steps above to create a signed `.wgt` and install it on a TV.
